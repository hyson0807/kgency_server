import{formatISO as t,parseISO as e}from"date-fns";import s from"image-to-base64";import a from"qs";import{randomBytes as r,createHmac as i}from"node:crypto";function n(t,e,s,a){Object.defineProperty(t,e,{get:s,set:a,enumerable:!0,configurable:!0})}class o{constructor(t){this.pfId=t.pfId,this.templateId=t.templateId,this.variables=t.variables,this.disableSms=t.disableSms,this.adFlag=t.adFlag,this.buttons=t.buttons,this.imageId=t.imageId}}class h{constructor(t){this.brandId=t.brandId,this.templateId=t.templateId,this.copyAllowed=t.copyAllowed,this.mmsType=t.mmsType,this.commercialType=t.commercialType,this.variables=t.variables,this.disableSms=t.disableSms,this.additionalBody=t.additionalBody,this.buttons=t.buttons}}class l{constructor(t){this.to=t.to,this.from=t.from,this.text=t.text,this.imageId=t.imageId,this.type=t.type,this.subject=t.subject,this.autoTypeDetect=t.autoTypeDetect,this.country=t.country,void 0!=t.kakaoOptions&&(this.kakaoOptions=new o(t.kakaoOptions)),void 0!=t.rcsOptions&&(this.rcsOptions=new h(t.rcsOptions)),this.customFields=t.customFields,this.replacements=t.replacements,this.faxOptions=t.faxOptions}}var d,u={};n(u,"InvalidDateError",()=>c),n(u,"ApiKeyError",()=>m),n(u,"DefaultError",()=>p),n(u,"MessageNotReceivedError",()=>g),n(u,"BadRequestError",()=>y);class c extends Error{constructor(t){super(t),this.name="InvalidDateError"}}class m extends Error{constructor(t){super(t),this.name="InvalidApiKeyError"}}class p extends Error{constructor(t,e){super(e),this.name=t}}class g extends Error{constructor(t){super(`${t.length}\u{AC1C}\u{C758} \u{BA54}\u{C2DC}\u{C9C0}\u{AC00} \u{C811}\u{C218}\u{B418}\u{C9C0} \u{BABB}\u{D588}\u{C2B5}\u{B2C8}\u{B2E4}. \u{C790}\u{C138}\u{D55C} \u{C5D0}\u{B7EC} \u{BA54}\u{C2DC}\u{C9C0}\u{B294} \u{D574}\u{B2F9} \u{C5D0}\u{B7EC} \u{B0B4} failedMessageList\u{B97C} \u{D655}\u{C778}\u{D574}\u{C8FC}\u{C138}\u{C694}.`),this.name="MessagesNotReceivedError",this.failedMessageList=t}}class y extends Error{constructor(t){super(t),this.name="BadRequestError"}}function f(e){return t(I(e))}function I(t){if("string"==typeof t){t=e(t);let s="Invalid Date";if(t.toString()===s)throw new c(s)}return t}let b={sdkVersion:"nodejs/5.4.0",osPlatform:`${process.platform} | ${process.version}`};class k{constructor(){this.agent=b,this.allowDuplicates=!1}}class $ extends k{constructor(t,e,s){super(),this.message=t,"boolean"==typeof e&&(this.allowDuplicates=e),s&&(this.agent.appId=s)}}class v extends k{constructor(t,e,s,a,r){super(),this.messages=t,e&&(this.allowDuplicates=e),s&&(this.agent.appId=s),a&&(this.scheduledDate=f(a)),r&&(this.showMessageList=r)}}class w{constructor(t){this.messages=t}}var T=((d=T||{})[d.API_KEY=0]="API_KEY",d);async function C(e,s,a){let n=function(e,s=0){let{apiKey:a,apiSecret:n}=e;{let e=function(t,e){let s=r(32),a="";for(let e=0;e<32;e++)a+=t[s[e]%t.length];return a}("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",32),s=t(new Date);if(!a||!n||""===a||""===n)throw new m("Invalid API Key Error");let o=i("sha256",n);o.update(s+e);let h=o.digest("hex");return`HMAC-SHA256 apiKey=${a}, date=${s}, salt=${e}, signature=${h}`}}(e);return await fetch(s.url,{headers:{Authorization:n,"Content-Type":"application/json"},body:JSON.stringify(a),method:s.method}).then(async t=>{if(t.status>=400&&t.status<500){let e=await t.json();throw new p(e.errorCode,e.errorMessage)}if(t.status>=500)throw new p("UnknownError",await t.text());try{return t.json()}catch(e){throw console.error(e),Error(await t.text())}})}class D{constructor(t){this.channelId=t.channelId,this.searchId=t.searchId,this.accountId=t.accountId,this.phoneNumber=t.phoneNumber,this.sharedAccountIds=t.sharedAccountIds,void 0!=t.dateCreated&&(this.dateCreated=I(t.dateCreated)),void 0!=t.dateUpdated&&(this.dateUpdated=I(t.dateUpdated))}}class E{constructor(t){this.channelId=t.channelId,this.channelGroupId=t.channelGroupId,this.name=t.name,this.content=t.content,this.ad=t.ad,this.assignType=t.assignType,this.buttons=t.buttons,this.templateId=t.templateId,this.header=t.header,this.item=t.item,this.highlight=t.highlight,this.securityFlag=t.securityFlag,this.isHidden=t.isHidden,this.messageType=t.messageType,this.emphasizeType=t.emphasizeType,this.extra=t.extra,this.emphasizeTitle=t.emphasizeTitle,this.emphasizeSubtitle=t.emphasizeSubtitle,this.imageId=t.imageId,this.quickReplies=t.quickReplies,this.comments=t.comments,this.commentable=t.commentable,this.code=t.code,this.status=t.status,"dateCreated"in t&&(this.dateCreated=I(t.dateCreated)),"dateUpdated"in t&&(this.dateUpdated=I(t.dateUpdated))}}class K{constructor(t){this.channelId=t.channelId,this.isHidden=t.isHidden,void 0!=t.name&&("string"==typeof t.name?this.name={like:t.name}:"object"==typeof t.name&&(this.name=t.name)),this.startKey=t.startKey,this.status=t.status,this.limit=t.limit,void 0!=t.startDate&&(this.dateCreated=Object.assign(this.dateCreated??{},{gte:f(t.startDate)})),void 0!=t.endDate&&(this.dateCreated=Object.assign(this.dateCreated??{},{lte:f(t.endDate)}))}}class U{constructor(t){this.channelId=t.channelId,this.searchId=t.searchId,this.phoneNumber=t.phoneNumber,this.categoryCode=t.categoryCode,this.startKey=t.startKey,this.limit=t.limit,this.isMine=t.isMine,void 0!=t.startDate&&(this.dateCreated=Object.assign(this.dateCreated??{},{gte:f(t.startDate)})),void 0!=t.endDate&&(this.dateCreated=Object.assign(this.dateCreated??{},{lte:f(t.endDate)}))}}class A{constructor(t){t.groupId&&(this.criteria="groupId",this.cond="eq",this.value=t.groupId),this.startKey=t.startKey,this.limit=t.limit,t.startDate&&(this.startDate=f(t.startDate)),t.endDate&&(this.endDate=f(t.endDate))}}class G{constructor(t){this.type="DENIAL",this.type="DENIAL",this.senderNumber=t.senderNumber,this.startKey=t.startKey,this.limit=t.limit,void 0!=t.startDate&&(this.dateCreated=Object.assign(this.dateCreated??{},{gte:f(t.startDate)})),void 0!=t.endDate&&(this.dateCreated=Object.assign(this.dateCreated??{},{lte:f(t.endDate)}))}}class x{constructor(t){this.blockGroupId=t.blockGroupId,this.useAll=t.useAll,this.senderNumber=t.senderNumber,void 0!=t.name&&("string"==typeof t.name?this.name={like:t.name}:this.name=t.name),this.status=t.status,this.startKey=t.startKey,this.limit=t.limit}}class O{constructor(t){this.blockNumberId=t.blockNumberId,this.phoneNumber=t.phoneNumber,this.blockGroupId=t.blockGroupId,void 0!=t.memo&&("string"==typeof t.memo?this.memo={like:t.memo}:this.memo=t.memo),this.startKey=t.startKey,this.limit=t.limit}}class P{constructor(t){this.dateType="CREATED",this.startKey=t.startKey,this.limit=t.limit,t.dateType&&(this.dateType=t.dateType),t.startDate&&(this.startDate=f(t.startDate)),t.endDate&&(this.endDate=f(t.endDate)),this.messageId=t.messageId,this.messageIds=t.messageIds,this.groupId=t.groupId,this.to=t.to,this.from=t.from,this.type=t.type,this.statusCode=t.statusCode}}class B{constructor(t){t.startDate&&(this.startDate=f(t.startDate)),t.endDate&&(this.endDate=f(t.endDate)),this.masterAccountId=t.masterAccountId}}class S{constructor(t,e){this.baseUrl="https://api.solapi.com",this.authInfo={apiKey:t,apiSecret:e}}async send(t,e){let s=[];if(Array.isArray(t))t.forEach(t=>{s.push(new l(t))});else if(Array.isArray(t))throw new y("잘못된 값이 입력되었습니다.");else s.push(new l(t));if(0===s.length)throw new y("데이터가 반드시 1건 이상 기입되어 있어야 합니다.");let a=new v(s,e?.allowDuplicates,e?.appId,e?.scheduledDate,e?.showMessageList),r={method:"POST",url:`${this.baseUrl}/messages/v4/send-many/detail`};return C(this.authInfo,r,a).then(t=>{let e=t.groupInfo.count;if(t.failedMessageList.length>0&&e.total===e.registeredFailed)throw new g(t.failedMessageList);return t})}async sendOne(t,e){let s=new $(t,!1,e),a={method:"POST",url:`${this.baseUrl}/messages/v4/send`};return C(this.authInfo,a,s)}async sendOneFuture(t,e){let s=await this.createGroup();return await this.addMessagesToGroup(s,[t]),e=I(e),this.reserveGroup(s,e)}async createGroup(t,e,s){t=t??!1;let{sdkVersion:a,osPlatform:r}=b,i={method:"POST",url:`${this.baseUrl}/messages/v4/groups`};return C(this.authInfo,i,{sdkVersion:a,osPlatform:r,allowDuplicates:t,appId:e,customFields:s}).then(t=>t.groupId)}async addMessagesToGroup(t,e){let s={method:"PUT",url:`${this.baseUrl}/messages/v4/groups/${t}/messages`};return C(this.authInfo,s,new w(e))}async sendGroup(t){let e={method:"POST",url:`${this.baseUrl}/messages/v4/groups/${t}/send`};return C(this.authInfo,e)}async reserveGroup(e,s){let a={method:"POST",url:`${this.baseUrl}/messages/v4/groups/${e}/schedule`},r=t(s);return C(this.authInfo,a,{scheduledDate:r})}async getGroup(t){let e={method:"GET",url:`${this.baseUrl}/messages/v4/groups/${t}`};return C(this.authInfo,e)}async getGroups(t){let e={};t&&(e=new A(t));let s=a.stringify(e,{indices:!1,addQueryPrefix:!0}),r=`${this.baseUrl}/messages/v4/groups${s}`;return C(this.authInfo,{method:"GET",url:r})}async getGroupMessages(t,e){let s=a.stringify(e,{indices:!1,addQueryPrefix:!0}),r=`${this.baseUrl}/messages/v4/groups/${t}/messages${s}`;return C(this.authInfo,{method:"GET",url:r})}async removeGroupMessages(t,e){let s={method:"DELETE",url:`${this.baseUrl}/messages/v4/groups/${t}/messages`};return C(this.authInfo,s,{messageIds:e})}async removeReservationToGroup(t){let e={method:"DELETE",url:`${this.baseUrl}/messages/v4/groups/${t}/schedule`};return C(this.authInfo,e)}async removeGroup(t){let e={method:"DELETE",url:`${this.baseUrl}/messages/v4/groups/${t}`};return C(this.authInfo,e)}async getMessages(t){let e={};t&&(e=new P(t));let s=a.stringify(e,{indices:!1,addQueryPrefix:!0}),r=`${this.baseUrl}/messages/v4/list${s}`;return C(this.authInfo,{method:"GET",url:r})}async getStatistics(t){let e={};t&&(e=new B(t));let s=a.stringify(e,{indices:!1,addQueryPrefix:!0}),r=`${this.baseUrl}/messages/v4/statistics${s}`;return C(this.authInfo,{method:"GET",url:r})}async getBalance(){let t={method:"GET",url:`${this.baseUrl}/cash/v1/balance`},e=await C(this.authInfo,t);return{balance:e.balance,point:e.point}}async uploadFile(t,e,a,r){let i=await s(t),n={method:"POST",url:`${this.baseUrl}/storage/v1/files`};return C(this.authInfo,n,{file:i,type:e,name:a,link:r})}async getKakaoChannelCategories(){let t={method:"GET",url:`${this.baseUrl}/kakao/v2/channels/categories`};return C(this.authInfo,t)}async getKakaoChannels(t){let e={};t&&(e=new U(t));let s=a.stringify(e,{indices:!1}),r=`${this.baseUrl}/kakao/v2/channels?${s}`,i=await C(this.authInfo,{method:"GET",url:r}),n=[];for(let t of i.channelList)n.push(new D(t));return{limit:i.limit,nextKey:i.nextKey,startKey:i.startKey,channelList:n}}async getKakaoChannel(t){let e={method:"GET",url:`${this.baseUrl}/kakao/v2/channels/${t}`};return new D(await C(this.authInfo,e))}async requestKakaoChannelToken(t){let e={method:"POST",url:`${this.baseUrl}/kakao/v2/channels/token`};return C(this.authInfo,e,t)}async createKakaoChannel(t){let e={method:"POST",url:`${this.baseUrl}/kakao/v2/channels`};return C(this.authInfo,e,t)}async removeKakaoChannel(t){let e={method:"DELETE",url:`${this.baseUrl}/kakao/v2/channels/${t}`};return C(this.authInfo,e)}async getKakaoAlimtalkTemplates(t){let e={};t&&(e=new K(t));let s=a.stringify(e,{indices:!1}),r=`${this.baseUrl}/kakao/v2/templates?${s}`,i=await C(this.authInfo,{method:"GET",url:r}),n=[];for(let t of i.templateList)n.push(new E(t));return{limit:i.limit,nextKey:i.nextKey,startKey:i.startKey,templateList:n}}async getKakaoAlimtalkTemplate(t){let e={method:"GET",url:`${this.baseUrl}/kakao/v2/templates/${t}`};return new E(await C(this.authInfo,e))}async getKakaoAlimtalkTemplateCategories(){let t={method:"GET",url:`${this.baseUrl}/kakao/v2/templates/categories`};return C(this.authInfo,t)}async createKakaoAlimtalkTemplate(t){let e={method:"POST",url:`${this.baseUrl}/kakao/v2/templates`};return new E(await C(this.authInfo,e,t))}async requestInspectionKakaoAlimtalkTemplate(t){let e={method:"PUT",url:`${this.baseUrl}/kakao/v2/templates/${t}/inspection`};return new E(await C(this.authInfo,e))}async cancelInspectionKakaoAlimtalkTemplate(t){let e={method:"PUT",url:`${this.baseUrl}/kakao/v2/templates/${t}/inspection/cancel`};return new E(await C(this.authInfo,e))}async updateKakaoAlimtalkTemplate(t,e){let s={method:"PUT",url:`${this.baseUrl}/kakao/v2/templates/${t}`};return new E(await C(this.authInfo,s,e))}async updateKakaoAlimtalkTemplateName(t,e){let s={method:"PUT",url:`${this.baseUrl}/kakao/v2/templates/${t}/name`};return new E(await C(this.authInfo,s,{name:e}))}async deleteKakaoAlimtalkTemplate(t){return this.removeKakaoAlimtalkTemplate(t)}async removeKakaoAlimtalkTemplate(t){let e={method:"DELETE",url:`${this.baseUrl}/kakao/v2/templates/${t}`};return new E(await C(this.authInfo,e))}async getBlacks(t){let e={type:"DENIAL"};t&&(e=new G(t));let s=a.stringify(e,{indices:!1,addQueryPrefix:!0}),r=`${this.baseUrl}/iam/v1/black${s}`;return C(this.authInfo,{method:"GET",url:r})}async getBlockGroups(t){let e={};t&&(e=new x(t));let s=a.stringify(e,{indices:!1,addQueryPrefix:!0}),r=`${this.baseUrl}/iam/v1/block/groups${s}`;return C(this.authInfo,{method:"GET",url:r})}async getBlockNumbers(t){let e={};t&&(e=new O(t));let s=a.stringify(e,{indices:!1,addQueryPrefix:!0}),r=`${this.baseUrl}/iam/v1/block/numbers${s}`;return C(this.authInfo,{method:"GET",url:r})}}export{S as SolapiMessageService,c as InvalidDateError,m as ApiKeyError,p as DefaultError,g as MessageNotReceivedError,y as BadRequestError};
//# sourceMappingURL=index.mjs.map
